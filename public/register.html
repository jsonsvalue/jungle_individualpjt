<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Artist's Canvas</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
    integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
    
    <!-- jQuery and Bootstrap Bundle (includes Popper) -->
    <!-- 일반 jQuery 버전 로드 -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns"
        crossorigin="anonymous"></script>
    
    <style>
        /* CSS styles can go here */
        body {
            text-align: center;
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 20px;
            padding: 15px;
        }
        h1 {
            color: #333;
        }
        div{
            padding-top: 5px;
        }
        h2{
            padding-top: 20px;
        }
        .checkBtn {
            margin-left: 10px;
            width:80px;
            height: 40px;
        }

        .Title{
            text-align: center;
            font-size: 40px;
        }
        .wrap {
            margin: 10px auto;
            width: 300px;
        }
        .Horizontal{
            width: auto;
            display: flex;
            justify-content: space-between;
        }
    </style>

    <script>
        function ActiveAll()
        {
            $('#email').prop('disabled', false)
        }
        function ActiveSignup()
        {
            var password = $('#password').val();
            var confirmpassword = $('#confirmpassword').val();

            if (confirmpassword.length > 0) {
                if (confirmpassword === password) {
                    //비밀번호 이상없음
                    if($('#email').hasClass('is-valid') && $('#username').val()!="")
                    {
                        $('#signupBtn').prop('disabled', false)
                    }
                    else
                    {
                        $('#signupBtn').prop('disabled', true)
                    }
                    $('#confirmpassword').removeClass('is-invalid').addClass('is-valid');
                } else {
                    $('#confirmpassword').removeClass('is-valid').addClass('is-invalid');
                    $('#signupBtn').prop('disabled', true)
                }
            }
        }
    $(document).ready(function(){
        $('#confirmpassword').on('input', ()=>ActiveSignup());
        $('#password').on('input', ()=>ActiveSignup());
        $('#username').on('input', ()=>ActiveSignup());
        $('#checkBtn').click(function(){
            
            const email = $('#email').val();
            $.ajax({
                url: '/register',
                type: 'POST',
                data:{confirmEmail: email},
                success: function(response) {
                    /* 중복 아이디 검출 */
                    if (response.exists) {
                        $('#email').removeClass('is-valid').addClass('is-invalid')
                    } else {
                        $('#email').removeClass('is-invalid').addClass('is-valid')
                        /*중복체크 버튼 비활성화*/
                        $('#email').prop('disabled', true)
                        $('#checkBtn').prop('disabled', true)
                        $('#checkBtn').text('완료')
                    }
                },
                error: function(error) {
                    console.log(error);
                    $('#usernameFeedback').text('An error occurred.').css('color', 'red');
                }
            });
        });
    });
        
    </script>
</head>

<body>
    
    <div class="wrap">
        <header>
            <h1 class="Title">그림쟁이의 캔버스</h1>
        </header>

        <form action="/register" method="post" autocomplete="off" >
            <div>
                <h2>회원가입</h2>
            </div>
            <div class="Horizontal">
                <div>
                    <input type="email" placeholder="E-Mail" class="form-control" name="email" id="email" required autocomplete="email">
                    <div class="valid-feedback">
                    </div>
                    <div id="validationServer04Feedback"  class="invalid-feedback">
                        중복된 아이디입니다.
                    </div>
                </div>
                <div>
                    <button class="checkBtn" id="checkBtn">중복체크</button>
                </div>
            </div>
            <div>
                <input type="password" placeholder="PW" class="form-control" name="password" id="password" required autocomplete="new-password">
            </div>
            <div>
                <input type="password" placeholder="Confirm PW" class="form-control" name="confirmpassword" id="confirmpassword" required autocomplete="new-password">
                <div class="valid-feedback">
                </div>
                <div id="validationServer04Feedback"  class="invalid-feedback">
                    입력하신 비밀번호와 일치하지 않습니다.
                </div>
            </div>
            <div>
                <input type="text" placeholder="Name" class="form-control" name="username" id="username" required autocomplete="off">
            </div>
            <h2></h2>
            <div>
                <a href="/login"  class="btn btn-danger">취소</a>
                <button onclick="ActiveAll()" type="submit" class="btn btn btn-success" id="signupBtn" disabled="true">회원가입</button>
            </div>
        </form>
        
    </div>
    
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <script>
                alert("{{ messages[0]}}");
            </script>
        {% endif %}
    {% endwith %}
</body>
</html>
